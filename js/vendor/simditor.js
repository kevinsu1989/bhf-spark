(function(){var t,e,r,i=[].slice,n={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=function(){function t(){}return t.extend=function(t){var e,r,i;if(null!=t&&"object"==typeof t){for(e in t)r=t[e],"included"!==e&&"extended"!==e&&(this[e]=r);return null!=(i=t.extended)?i.call(this):void 0}},t.include=function(t){var e,r,i;if(null!=t&&"object"==typeof t){for(e in t)r=t[e],"included"!==e&&"extended"!==e&&(this.prototype[e]=r);return null!=(i=t.included)?i.call(this):void 0}},t.prototype.on=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=$(this)).on.apply(e,t)},t.prototype.one=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=$(this)).one.apply(e,t)},t.prototype.off=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=$(this)).off.apply(e,t)},t.prototype.trigger=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=$(this)).trigger.apply(e,t)},t.prototype.triggerHandler=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=$(this)).triggerHandler.apply(e,t)},t.prototype._t=function(t){var e,r;return e=this.constructor,null!=(r=e.i18n[e.locale])?r[t]:void 0},t.i18n={"zh-CN":{}},t.locale="zh-CN",t}(),r=function(t){function e(t){var e,r,i,n,o,s,a;for(this.opts=$.extend({},this.opts,t),(o=this.constructor)._connectedClasses||(o._connectedClasses=[]),i=function(){var t,r,i,o;for(i=this.constructor._connectedClasses,o=[],t=0,r=i.length;r>t;t++)e=i[t],n=e.className.charAt(0).toLowerCase()+e.className.slice(1),o.push(this[n]=new e(this));return o}.call(this),this._init(),s=0,a=i.length;a>s;s++)r=i[s],"function"==typeof r._init&&r._init();this.trigger("pluginconnected")}return o(e,t),e.connect=function(t){if("function"==typeof t){if(!t.className)throw new Error('Widget.connect: lack of class property "className"');return this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(t),t.className?this[t.className]=t:void 0}},e.prototype._init=function(){},e.prototype.opts={},e.prototype.destroy=function(){},e}(t),e=function(t){function e(t){this.widget=t,this.opts=$.extend({},this.opts,this.widget.opts)}return o(e,t),e.className="Plugin",e.prototype.opts={},e.prototype._init=function(){},e}(t),window.Module=t,window.Widget=r,window.Plugin=e}).call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function i(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t};t=function(t){function e(t){var r=this;null==t&&(t={}),this.files=[],this.queue=[],this.opts=$.extend({},this.opts,t),this.id=++e.count,this.on("uploadcomplete",function(t,e){return r.files.splice($.inArray(e,r.files),1),r.queue.length>0&&r.files.length<r.opts.connectionCount?r.upload(r.queue.shift()):r.uploading=!1}),$(window).on("beforeunload.uploader-"+this.id,function(t){return r.uploading?(t.originalEvent.returnValue=r._t("leaveConfirm"),r._t("leaveConfirm")):void 0})}return r(e,t),e.count=0,e.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},e.prototype.generateId=function(){var t;return t=0,function(){return t+=1}}(),e.prototype.upload=function(t,e){var r,i,n,o;if(null==e&&(e={}),null!=t){if($.isArray(t))for(n=0,o=t.length;o>n;n++)r=t[n],this.upload(r,e);else $(t).is("input:file")?(i=$(t).attr("name"),i&&(e.fileKey=i),this.upload($.makeArray($(t)[0].files),e)):t.id&&t.obj||(t=this.getFile(t));if(t&&t.obj){if($.extend(t,e),this.files.length>=this.opts.connectionCount)return void this.queue.push(t);if(this.triggerHandler("beforeupload",[t])!==!1)return this.files.push(t),this._xhrUpload(t),this.uploading=!0}}},e.prototype.getFile=function(t){var e,r,i;return t instanceof window.File||t instanceof window.Blob?(e=null!=(r=t.fileName)?r:t.name,{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:e,size:null!=(i=t.fileSize)?i:t.size,ext:e?e.split(".").pop().toLowerCase():"",obj:t}):null},e.prototype._xhrUpload=function(t){var e,r,i,n,o=this;if(e=new FormData,e.append(t.fileKey,t.obj),e.append("original_filename",t.name),t.params){n=t.params;for(r in n)i=n[r],e.append(r,i)}return t.xhr=$.ajax({url:t.url,data:e,dataType:"json",processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t,e=this;return t=$.ajaxSettings.xhr(),t&&(t.upload.onprogress=function(t){return e.progress(t)}),t},progress:function(e){return e.lengthComputable?o.trigger("uploadprogress",[t,e.loaded,e.total]):void 0},error:function(e,r){return o.trigger("uploaderror",[t,e,r])},success:function(e){return o.trigger("uploadprogress",[t,t.size,t.size]),o.trigger("uploadsuccess",[t,e])},complete:function(e){return o.trigger("uploadcomplete",[t,e.responseText])}})},e.prototype.cancel=function(t){var e,r,i,n;if(!t.id)for(n=this.files,r=0,i=n.length;i>r;r++)if(e=n[r],e.id===1*t){t=e;break}return this.trigger("uploadcancel",[t]),t.xhr&&t.xhr.abort(),t.xhr=null},e.prototype.readImageFile=function(t,e){var r,i;if($.isFunction(e))return i=new Image,i.onload=function(){return e(i)},i.onerror=function(){return e()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(r=new FileReader,r.onload=function(t){return i.src=t.target.result},r.readAsDataURL(t)):e()},e.prototype.destroy=function(){var t,e,r,i;for(this.queue.length=0,i=this.files,e=0,r=i.length;r>e;e++)t=i[e],this.cancel(t);return $(window).off(".uploader-"+this.id),$(document).off(".uploader-"+this.id)},e.i18n={"zh-CN":{leaveConfirm:"正在上传文件，如果离开上传会自动取消"}},e.locale="zh-CN",e}(Module),this.simple||(this.simple={}),this.simple.uploader=function(e){return new t(e)}}.call(this),function(){var t,e,r,i,n,o,s,a,l,d,u,p,c,h,f,g,m,v,y,b,_,w,x,T,C,k,A,E,B,R,N={}.hasOwnProperty,S=function(t,e){function r(){this.constructor=t}for(var i in e)N.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},M=[].slice,O=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};_=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.sel=document.getSelection(),this.editor=this.widget}return S(e,t),e.className="Selection",e.prototype._init=function(){},e.prototype.clear=function(){var t;try{return this.sel.removeAllRanges()}catch(e){t=e}},e.prototype.getRange=function(){return this.editor.inputManager.focused&&this.sel.rangeCount?this.sel.getRangeAt(0):null},e.prototype.selectRange=function(t){return this.clear(),this.sel.addRange(t),this.editor.inputManager.focused||!this.editor.util.browser.firefox&&!this.editor.util.browser.msie?void 0:this.editor.body.focus()},e.prototype.rangeAtEndOf=function(t,e){var r,i,n;return null==e&&(e=this.getRange()),null!=e&&e.collapsed?(t=$(t)[0],r=e.endContainer,i=this.editor.util.getNodeLength(r),e.endOffset===i-1&&$(r).contents().last().is("br")||e.endOffset===i?t===r?!0:$.contains(t,r)?(n=!0,$(r).parentsUntil(t).addBack().each(function(){return function(t,e){var r,i;return i=$(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}),r=i.last(),r.get(0)===e||r.is("br")&&r.prev().get(0)===e?void 0:(n=!1,!1)}}(this)),n):!1:!1):void 0},e.prototype.rangeAtStartOf=function(t,e){var r,i;return null==e&&(e=this.getRange()),null!=e&&e.collapsed?(t=$(t)[0],i=e.startContainer,0!==e.startOffset?!1:t===i?!0:$.contains(t,i)?(r=!0,$(i).parentsUntil(t).addBack().each(function(){return function(t,e){var i;return i=$(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}),i.first().get(0)!==e?r=!1:void 0}}(this)),r):!1):void 0},e.prototype.insertNode=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.insertNode(t),this.setRangeAfter(t,e)):void 0},e.prototype.setRangeAfter=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.setEndAfter(t),e.collapse(!1),this.selectRange(e)):void 0},e.prototype.setRangeBefore=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.setEndBefore(t),e.collapse(!1),this.selectRange(e)):void 0},e.prototype.setRangeAtStartOf=function(t,e){return null==e&&(e=this.getRange()),t=$(t).get(0),e.setEnd(t,0),e.collapse(!1),this.selectRange(e)},e.prototype.setRangeAtEndOf=function(t,e){var r,i,n,o,s,a;return null==e&&(e=this.getRange()),i=$(t),t=i.get(0),i.is("pre")?(n=i.contents(),n.length>0?(o=n.last(),s=o.text(),"\n"===s.charAt(s.length-1)?e.setEnd(o[0],this.editor.util.getNodeLength(o[0])-1):e.setEnd(o[0],this.editor.util.getNodeLength(o[0]))):e.setEnd(t,0)):(a=this.editor.util.getNodeLength(t),3!==t.nodeType&&a>0&&(r=$(t).contents().last(),r.is("br")?a-=1:3!==r[0].nodeType&&this.editor.util.isEmptyNode(r)&&(r.append(this.editor.util.phBr),t=r[0],a=0)),e.setEnd(t,a)),e.collapse(!1),this.selectRange(e)},e.prototype.deleteRangeContents=function(t){var e,r;return null==t&&(t=this.getRange()),r=t.cloneRange(),e=t.cloneRange(),r.collapse(!0),e.collapse(!1),!t.collapsed&&this.rangeAtStartOf(this.editor.body,r)&&this.rangeAtEndOf(this.editor.body,e)?(this.editor.body.empty(),t.setStart(this.editor.body[0],0),t.collapse(!0),this.selectRange(t)):t.deleteContents(),t},e.prototype.breakBlockEl=function(t,e){var r;return null==e&&(e=this.getRange()),r=$(t),e.collapsed?(e.setStartBefore(r.get(0)),e.collapsed?r:r.before(e.extractContents())):r},e.prototype.save=function(t){var e,r;return null==t&&(t=this.getRange()),this._selectionSaved?void 0:(r=$("<span/>").addClass("simditor-caret-start"),e=$("<span/>").addClass("simditor-caret-end"),t.insertNode(r[0]),t.collapse(!1),t.insertNode(e[0]),this.clear(),this._selectionSaved=!0)},e.prototype.restore=function(){var t,e,r,i,n,o,s;return this._selectionSaved?(n=this.editor.body.find(".simditor-caret-start"),t=this.editor.body.find(".simditor-caret-end"),n.length&&t.length?(o=n.parent(),s=o.contents().index(n),e=t.parent(),r=e.contents().index(t),o[0]===e[0]&&(r-=1),i=document.createRange(),i.setStart(o.get(0),s),i.setEnd(e.get(0),r),n.remove(),t.remove(),this.selectRange(i)):(n.remove(),t.remove()),this._selectionSaved=!1,i):!1},e}(Plugin),s=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.editor=this.widget,this._allowedTags=["br","a","img","b","strong","i","u","font","p","ul","ol","li","blockquote","pre","h1","h2","h3","h4","hr"],this._allowedAttributes={img:["src","alt","width","height","data-image-src","data-image-size","data-image-name","data-non-image"],a:["href","target"],font:["color"],pre:["data-lang","class"],p:["data-indent"],h1:["data-indent"],h2:["data-indent"],h3:["data-indent"],h4:["data-indent"]}}return S(e,t),e.className="Formatter",e.prototype._init=function(){return this.editor.body.on("click","a",function(){return function(){return!1}}(this))},e.prototype.decorate=function(t){return null==t&&(t=this.editor.body),this.editor.trigger("decorate",[t])},e.prototype.undecorate=function(t){return null==t&&(t=this.editor.body.clone()),this.editor.trigger("undecorate",[t]),$.trim(t.html())},e.prototype.autolink=function(t){var e,r,i,n,o,s,a,l,d,u,p;for(null==t&&(t=this.editor.body),n=[],r=function(e){return e.contents().each(function(e,i){var o,s;return o=$(i),o.is("a")||o.closest("a, pre",t).length?void 0:o.contents().length?r(o):(s=o.text())&&/https?:\/\/|www\./gi.test(s)?n.push(o):void 0})},r(t),s=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,u=0,p=n.length;p>u;u++){for(e=n[u],l=e.text(),a=[],o=null,i=0;null!==(o=s.exec(l));)a.push(document.createTextNode(l.substring(i,o.index))),i=s.lastIndex,d=/^(http(s)?:\/\/|\/)/.test(o[0])?o[0]:"http://"+o[0],a.push($('<a href="'+d+'" rel="nofollow"></a>').text(o[0])[0]);a.push(document.createTextNode(l.substring(i))),e.replaceWith($(a))}return t},e.prototype.format=function(t){var e,r,i,n,o,s,a,l,d,u;if(null==t&&(t=this.editor.body),t.is(":empty"))return t.append("<p>"+this.editor.util.phBr+"</p>"),t;for(d=t.contents(),o=0,a=d.length;a>o;o++)i=d[o],this.cleanNode(i,!0);for(u=t.contents(),s=0,l=u.length;l>s;s++)n=u[s],e=$(n),e.is("br")?("undefined"!=typeof r&&null!==r&&(r=null),e.remove()):this.editor.util.isBlockNode(n)?e.is("li")?r&&r.is("ul, ol")?r.append(n):(r=$("<ul/>").insertBefore(n),r.append(n)):r=null:((!r||r.is("ul, ol"))&&(r=$("<p/>").insertBefore(n)),r.append(n));return t},e.prototype.cleanNode=function(t,e){var r,i,n,o,s,a,l,d,u,p,c,h,f,g,m,v,y;if(i=$(t),3===i[0].nodeType)return p=i.text().replace(/(\r\n|\n|\r)/gm,""),void(p?(c=document.createTextNode(p),i.replaceWith(c)):i.remove());if(l=i.contents(),d=i.is('[class^="simditor-"]'),i.is(this._allowedTags.join(","))||d){if(i.is("a")&&(r=i.find("img")).length>0&&(i.replaceWith(r),i=r,l=null),i.is("img")&&i.hasClass("uploading")&&i.remove(),!d)for(s=this._allowedAttributes[i[0].tagName.toLowerCase()],v=$.makeArray(i[0].attributes),h=0,g=v.length;g>h;h++)a=v[h],null!=s&&(y=a.name,O.call(s,y)>=0)||i.removeAttr(a.name)}else 1!==i[0].nodeType||i.is(":empty")?(i.remove(),l=null):i.is("div, article, dl, header, footer, tr")?(i.append("<br/>"),l.first().unwrap()):i.is("table")?(n=$("<p/>"),i.find("tr").each(function(){return function(t,e){return n.append($(e).text()+"<br/>")}}(this)),i.replaceWith(n),l=null):i.is("thead, tfoot")?(i.remove(),l=null):i.is("th")?(o=$("<td/>").append(i.contents()),i.replaceWith(o)):l.first().unwrap();if(e&&null!=l&&!i.is("pre"))for(f=0,m=l.length;m>f;f++)u=l[f],this.cleanNode(u,!0);return null},e.prototype.clearHtml=function(t,e){var r,i,n;return null==e&&(e=!0),r=$("<div/>").append(t),i=r.contents(),n="",i.each(function(t){return function(r,o){var s,a;return 3===o.nodeType?n+=o.nodeValue:1===o.nodeType&&(s=$(o),a=s.contents(),a.length>0&&(n+=t.clearHtml(a)),e&&r<i.length-1&&s.is("br, p, div, li, tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2, h3, h4, header"))?n+="\n":void 0}}(this)),n},e.prototype.beautify=function(t){var e;return e=function(t){return!!(t.is("p")&&!t.text()&&t.children(":not(br)").length<1)},t.each(function(){return function(t,r){var i;return i=$(r),i.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty')&&i.remove(),e(i)&&i.remove(),i.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()}}(this))},e}(Plugin),p=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.editor=this.widget,this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this._keystrokeHandlers={},this._shortcuts={}}return S(e,t),e.className="InputManager",e.prototype.opts={pasteImage:!1},e.prototype._modifierKeys=[16,17,18,91,93,224],e.prototype._arrowKeys=[37,38,39,40],e.prototype._init=function(){var t;return this._pasteArea=$("<div/>").css({width:"1px",height:"1px",overflow:"hidden",position:"fixed",right:"0",bottom:"100px"}).attr({tabIndex:"-1",contentEditable:!0}).addClass("simditor-paste-area").appendTo(this.editor.el),this._cleanPasteArea=$("<textarea/>").css({width:"1px",height:"1px",overflow:"hidden",position:"fixed",right:"0",bottom:"101px"}).attr({tabIndex:"-1"}).addClass("simditor-clean-paste-area").appendTo(this.editor.el),this.editor.on("valuechanged",function(t){return function(){return t.editor.body.find("hr, pre, .simditor-table").each(function(e,r){var i,n;return i=$(r),(i.parent().is("blockquote")||i.parent()[0]===t.editor.body[0])&&(n=!1,0===i.next().length&&($("<p/>").append(t.editor.util.phBr).insertAfter(i),n=!0),0===i.prev().length&&($("<p/>").append(t.editor.util.phBr).insertBefore(i),n=!0),n)?setTimeout(function(){return t.editor.trigger("valuechanged")},10):void 0}),t.editor.body.find("pre:empty").append(t.editor.util.phBr)}}(this)),this.editor.body.on("keydown",$.proxy(this._onKeyDown,this)).on("keypress",$.proxy(this._onKeyPress,this)).on("keyup",$.proxy(this._onKeyUp,this)).on("mouseup",$.proxy(this._onMouseUp,this)).on("focus",$.proxy(this._onFocus,this)).on("blur",$.proxy(this._onBlur,this)).on("paste",$.proxy(this._onPaste,this)).on("drop",$.proxy(this._onDrop,this)),this.editor.util.browser.firefox&&(this.addShortcut("cmd+37",function(t){return function(e){return e.preventDefault(),t.editor.selection.sel.modify("move","backward","lineboundary"),!1}}(this)),this.addShortcut("cmd+39",function(t){return function(e){return e.preventDefault(),t.editor.selection.sel.modify("move","forward","lineboundary"),!1}}(this))),t=this.editor.util.os.mac?"cmd+13":"ctrl+13",this.addShortcut(t,function(t){return function(){return t.editor.el.closest("form").find("button:submit").click(),!1}}(this)),this.editor.textarea.attr("autofocus")?setTimeout(function(t){return function(){return t.editor.focus()}}(this),0):void 0},e.prototype._onFocus=function(){return this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,this.lastCaretPosition=null,setTimeout(function(t){return function(){return t.editor.triggerHandler("focus")}}(this),0)},e.prototype._onBlur=function(){var t;return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=null!=(t=this.editor.undoManager.currentState())?t.caret:void 0,this.editor.triggerHandler("blur")},e.prototype._onMouseUp=function(){return setTimeout(function(t){return function(){return t.editor.trigger("selectionchanged"),t.editor.undoManager.update()}}(this),0)},e.prototype._onKeyDown=function(t){var e,r,i,n,o,s,a;if(this.editor.triggerHandler(t)===!1)return!1;if(n=this.editor.util.getShortcutKey(t),this._shortcuts[n])return this._shortcuts[n].call(this,t);if(t.which in this._keystrokeHandlers){if(i="function"==typeof(o=this._keystrokeHandlers[t.which])["*"]?o["*"](t):void 0)return this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged"),!1;if(this.editor.util.traverseUp(function(e){return function(r){var n,o;if(1===r.nodeType)return n=null!=(o=e._keystrokeHandlers[t.which])?o[r.tagName.toLowerCase()]:void 0,i="function"==typeof n?n(t,$(r)):void 0,i===!0||i===!1?!1:void 0}}(this)),i)return this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged"),!1}return s=t.which,O.call(this._modifierKeys,s)>=0||(a=t.which,O.call(this._arrowKeys,a)>=0)||(r=this.editor.util.metaKey(t),e=this.editor.util.closestBlockEl(),r&&86===t.which)?void 0:(this.editor.util.browser.webkit&&8===t.which&&this.editor.selection.rangeAtStartOf(e)?(setTimeout(function(t){return function(){var e;return e=t.editor.util.closestBlockEl(),t.editor.selection.save(),t.editor.formatter.cleanNode(e,!0),t.editor.selection.restore(),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")}}(this),10),this.typing=!0):this._typing?(this._typing!==!0&&clearTimeout(this._typing),this._typing=setTimeout(function(t){return function(){return t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged"),t._typing=!1}}(this),200)):(setTimeout(function(t){return function(){return t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")}}(this),10),this._typing=!0),null)},e.prototype._onKeyPress=function(t){return this.editor.triggerHandler(t)===!1?!1:void 0},e.prototype._onKeyUp=function(t){var e,r;return this.editor.triggerHandler(t)===!1?!1:(r=t.which,O.call(this._arrowKeys,r)>=0?(this.editor.trigger("selectionchanged"),void this.editor.undoManager.update()):void(8!==t.which&&46!==t.which||!this.editor.util.isEmptyNode(this.editor.body)||(this.editor.body.empty(),e=$("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(e))))},e.prototype._onPaste=function(t){var e,r,i,n,o,s,a;if(this.editor.triggerHandler(t)===!1)return!1;if(o=this.editor.selection.deleteRangeContents(),o.collapsed||o.collapse(!0),e=this.editor.util.closestBlockEl(),r=e.is("pre, table"),t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length>0&&(n=t.originalEvent.clipboardData.items[0],/^image\//.test(n.type)&&!r)){if(i=n.getAsFile(),null==i||!this.opts.pasteImage)return;return i.name||(i.name="Clipboard Image.png"),s={},s[this.opts.pasteImage]=!0,null!=(a=this.editor.uploader)&&a.upload(i,s),!1}return this.editor.selection.save(o),r?(this._cleanPasteArea.focus(),this.editor.util.browser.firefox?(t.preventDefault(),this._cleanPasteArea.val(t.originalEvent.clipboardData.getData("text/plain"))):this.editor.util.browser.msie&&10===this.editor.util.browser.version&&(t.preventDefault(),this._cleanPasteArea.val(window.clipboardData.getData("Text")))):(this._pasteArea.focus(),this.editor.util.browser.msie&&10===this.editor.util.browser.version&&(t.preventDefault(),this._pasteArea.html(window.clipboardData.getData("Text")))),setTimeout(function(t){return function(){var i,n,a,l,d,u,p,c,h,f,g,m,v,y,b,_,w,x,T,C,k,A;if(t._pasteArea.is(":empty")&&!t._cleanPasteArea.val()?h=null:r?h=t._cleanPasteArea.val():(h=$("<div/>").append(t._pasteArea.contents()),t.editor.formatter.format(h),t.editor.formatter.decorate(h),t.editor.formatter.beautify(h.children()),h=h.contents()),t._pasteArea.empty(),t._cleanPasteArea.val(""),o=t.editor.selection.restore(),t.editor.triggerHandler("pasting",[h])!==!1&&h){if(r)if(e.is("table")){for(p=h.split("\n"),d=p.pop(),f=0,y=p.length;y>f;f++)u=p[f],t.editor.selection.insertNode(document.createTextNode(u)),t.editor.selection.insertNode($("<br/>"));t.editor.selection.insertNode(document.createTextNode(d))}else for(h=$("<div/>").text(h),C=h.contents(),g=0,b=C.length;b>g;g++)c=C[g],t.editor.selection.insertNode($(c)[0],o);else if(e.is(t.editor.body))for(m=0,_=h.length;_>m;m++)c=h[m],t.editor.selection.insertNode(c,o);else{if(h.length<1)return;if(1===h.length)if(h.is("p"))if(a=h.contents(),1===a.length&&a.is("img")){if(i=a,/^data:image/.test(i.attr("src"))){if(!t.opts.pasteImage)return;return n=t.editor.util.dataURLtoBlob(i.attr("src")),n.name="Clipboard Image.png",s={},s[t.opts.pasteImage]=!0,void(null!=(k=t.editor.uploader)&&k.upload(n,s))}if(i.is('img[src^="webkit-fake-url://"]'))return}else for(v=0,w=a.length;w>v;v++)c=a[v],t.editor.selection.insertNode(c,o);else if(e.is("p")&&t.editor.util.isEmptyNode(e))e.replaceWith(h),t.editor.selection.setRangeAtEndOf(h,o);else if(h.is("ul, ol"))if(1===h.find("li").length)for(h=$("<div/>").text(h.text()),A=h.contents(),T=0,x=A.length;x>T;T++)c=A[T],t.editor.selection.insertNode($(c)[0],o);else e.is("li")&&(e.parent().after(h),t.editor.selection.setRangeAtEndOf(h,o));else e.after(h),t.editor.selection.setRangeAtEndOf(h,o);else e.is("li")&&(e=e.parent()),t.editor.selection.rangeAtStartOf(e,o)?l="before":t.editor.selection.rangeAtEndOf(e,o)?l="after":(t.editor.selection.breakBlockEl(e,o),l="before"),e[l](h),t.editor.selection.setRangeAtEndOf(h.last(),o)}return t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")}}}(this),10)},e.prototype._onDrop=function(t){return this.editor.triggerHandler(t)===!1?!1:setTimeout(function(t){return function(){return t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")}}(this),0)},e.prototype.addKeystrokeHandler=function(t,e,r){return this._keystrokeHandlers[t]||(this._keystrokeHandlers[t]={}),this._keystrokeHandlers[t][e]=r},e.prototype.addShortcut=function(t,e){return this._shortcuts[t]=$.proxy(e,this)},e}(Plugin),h=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.editor=this.widget}return S(e,t),e.className="Keystroke",e.prototype._init=function(){var t;return this.editor.util.browser.safari&&this.editor.inputManager.addKeystrokeHandler("13","*",function(t){return function(e){var r;if(e.shiftKey)return r=$("<br/>"),t.editor.selection.rangeAtEndOf($blockEl)?(t.editor.selection.insertNode(r),t.editor.selection.insertNode($("<br/>")),t.editor.selection.setRangeBefore(r)):t.editor.selection.insertNode(r),!0}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(t=function(t){return function(e,r){var i;if(t.editor.selection.rangeAtEndOf(r))return i=$("<p/>").append(t.editor.util.phBr).insertAfter(r),t.editor.selection.setRangeAtStartOf(i),!0}}(this),this.editor.inputManager.addKeystrokeHandler("13","h1",t),this.editor.inputManager.addKeystrokeHandler("13","h2",t),this.editor.inputManager.addKeystrokeHandler("13","h3",t),this.editor.inputManager.addKeystrokeHandler("13","h4",t),this.editor.inputManager.addKeystrokeHandler("13","h5",t),this.editor.inputManager.addKeystrokeHandler("13","h6",t)),this.editor.inputManager.addKeystrokeHandler("8","*",function(t){return function(){var e,r;return r=t.editor.util.furthestBlockEl(),e=r.prev(),e.is("hr")&&t.editor.selection.rangeAtStartOf(r)?(t.editor.selection.save(),e.remove(),t.editor.selection.restore(),!0):void 0}}(this)),this.editor.inputManager.addKeystrokeHandler("9","*",function(t){return function(e){return t.editor.opts.tabIndent?(e.shiftKey?t.editor.util.outdent():t.editor.util.indent(),!0):void 0}}(this)),this.editor.inputManager.addKeystrokeHandler("13","li",function(t){return function(e,r){var i,n,o,s;if(i=r.clone(),i.find("ul, ol").remove(),t.editor.util.isEmptyNode(i)&&r.is(t.editor.util.closestBlockEl())){if(n=r.parent(),r.next("li").length>0){if(!t.editor.util.isEmptyNode(r))return;n.parent("li").length>0?(o=$("<li/>").append(t.editor.util.phBr).insertAfter(n.parent("li")),s=$("<"+n[0].tagName+"/>").append(r.nextAll("li")),o.append(s)):(o=$("<p/>").append(t.editor.util.phBr).insertAfter(n),s=$("<"+n[0].tagName+"/>").append(r.nextAll("li")),o.after(s))}else n.parent("li").length>0?(o=$("<li/>").insertAfter(n.parent("li")),o.append(r.contents().length>0?r.contents():t.editor.util.phBr)):(o=$("<p/>").append(t.editor.util.phBr).insertAfter(n),r.children("ul, ol").length>0&&o.after(r.children("ul, ol")));return r.prev("li").length?r.remove():n.remove(),t.editor.selection.setRangeAtStartOf(o),!0}}}(this)),this.editor.inputManager.addKeystrokeHandler("13","pre",function(t){return function(e,r){var i,n;return e.preventDefault(),n=t.editor.selection.getRange(),i=null,n.deleteContents(),!t.editor.util.browser.msie&&t.editor.selection.rangeAtEndOf(r)?(i=document.createTextNode("\n\n"),n.insertNode(i),n.setEnd(i,1)):(i=document.createTextNode("\n"),n.insertNode(i),n.setStartAfter(i)),n.collapse(!1),t.editor.selection.selectRange(n),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("13","blockquote",function(t){return function(e,r){var i;return i=t.editor.util.closestBlockEl(),i.is("p")&&!i.next().length&&t.editor.util.isEmptyNode(i)?(r.after(i),t.editor.selection.setRangeAtStartOf(i),!0):void 0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","li",function(t){return function(e,r){var i,n,o,s,a,l,d,u;return n=r.children("ul, ol"),a=r.prev("li"),n.length>0&&a.length>0?(u="",l=null,r.contents().each(function(t,e){if(1===e.nodeType&&/UL|OL/.test(e.nodeName))return!1;if(1!==e.nodeType||!/BR/.test(e.nodeName))return 3===e.nodeType&&e.nodeValue?u+=e.nodeValue:1===e.nodeType&&(u+=$(e).text()),l=$(e)}),l&&1===u.length&&t.editor.util.browser.firefox&&!l.next("br").length?(i=$(t.editor.util.phBr).insertAfter(l),l.remove(),t.editor.selection.setRangeBefore(i),!0):u.length>0?!1:(d=document.createRange(),s=a.children("ul, ol"),s.length>0?(o=$("<li/>").append(t.editor.util.phBr).appendTo(s),s.append(n.children("li")),r.remove(),t.editor.selection.setRangeAtEndOf(o,d)):(t.editor.selection.setRangeAtEndOf(a,d),a.append(n),r.remove(),t.editor.selection.selectRange(d)),!0)):!1}}(this)),this.editor.inputManager.addKeystrokeHandler("8","pre",function(t){return function(e,r){var i,n;if(t.editor.selection.rangeAtStartOf(r))return n=r.html().replace("\n","<br/>"),i=$("<p/>").append(n||t.editor.util.phBr).insertAfter(r),r.remove(),t.editor.selection.setRangeAtStartOf(i),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","blockquote",function(t){return function(e,r){var i;if(t.editor.selection.rangeAtStartOf(r))return i=r.children().first().unwrap(),t.editor.selection.setRangeAtStartOf(i),!0}}(this))},e}(Plugin),E=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.editor=this.widget,this._stack=[]}return S(e,t),e.className="UndoManager",e.prototype._index=-1,e.prototype._capacity=50,e.prototype._timer=null,e.prototype._init=function(){var t,e;return this.editor.util.os.mac?(e="cmd+90",t="shift+cmd+90"):this.editor.util.os.win?(e="ctrl+90",t="ctrl+89"):(e="ctrl+90",t="shift+ctrl+90"),this.editor.inputManager.addShortcut(e,function(t){return function(e){return e.preventDefault(),t.undo(),!1}}(this)),this.editor.inputManager.addShortcut(t,function(t){return function(e){return e.preventDefault(),t.redo(),!1}}(this)),this.editor.on("valuechanged",function(t){return function(e,r){return"undo"!==r?(t._timer&&(clearTimeout(t._timer),t._timer=null),t._timer=setTimeout(function(){return t._pushUndoState()},200)):void 0}}(this))},e.prototype._pushUndoState=function(){var t,e;if(this.editor.triggerHandler("pushundostate")!==!1&&(t=this.currentState(),e=this.editor.body.html(),!t||t.html!==e))return this._index+=1,this._stack.length=this._index,this._stack.push({html:e,caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},e.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},e.prototype.undo=function(){var t;if(!(this._index<1||this._stack.length<2))return this.editor.hidePopover(),this._index-=1,t=this._stack[this._index],this.editor.body.html(t.html),this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"]),this.editor.trigger("selectionchanged",["undo"])},e.prototype.redo=function(){var t;if(!(this._index<0||this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,t=this._stack[this._index],this.editor.body.html(t.html),this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"]),this.editor.trigger("selectionchanged",["undo"])},e.prototype.update=function(){var t,e;return(t=this.currentState())?(e=this.editor.body.html(),t.html=e,t.caret=this.caretPosition()):void 0},e.prototype._getNodeOffset=function(t,e){var r,i,n;return r=e?$(t):$(t).parent(),n=0,i=!1,r.contents().each(function(){return function(r,o){return e===r||t===o?!1:(3===o.nodeType?i||(n+=1,i=!0):(n+=1,i=!1),null)}}(this)),n},e.prototype._getNodePosition=function(t,e){var r,i;if(3===t.nodeType)for(i=t.previousSibling;i&&3===i.nodeType;)t=i,e+=this.editor.util.getNodeLength(i),i=i.previousSibling;else e=this._getNodeOffset(t,e);return r=[],r.unshift(e),this.editor.util.traverseUp(function(t){return function(e){return r.unshift(t._getNodeOffset(e))}}(this),t),r},e.prototype._getNodeByPosition=function(t){var e,r,i,n,o,s,a,l;for(n=this.editor.body[0],l=t.slice(0,t.length-1),i=s=0,a=l.length;a>s;i=++s){if(o=l[i],r=n.childNodes,o>r.length-1){if(i!==t.length-2||!$(n).is("pre")){n=null;break}e=document.createTextNode(""),n.appendChild(e),r=n.childNodes}n=r[o]}return n},e.prototype.caretPosition=function(t){var e,r,i,n,o;if(t){if(this.editor.inputManager.focused||this.editor.body.focus(),!t.start)return void this.editor.body.blur();if(n=this._getNodeByPosition(t.start),o=t.start[t.start.length-1],t.collapsed?(e=n,r=o):(e=this._getNodeByPosition(t.end),r=t.start[t.start.length-1]),!n||!e)throw new Error("simditor: invalid caret state");return i=document.createRange(),i.setStart(n,o),i.setEnd(e,r),this.editor.selection.selectRange(i)}return i=this.editor.selection.getRange(),this.editor.inputManager.focused&&null!=i?(t={start:[],end:null,collapsed:!0},t.start=this._getNodePosition(i.startContainer,i.startOffset),i.collapsed||(t.end=this._getNodePosition(i.endContainer,i.endOffset),t.collapsed=!1),t):{}},e}(Plugin),R=function(t){function e(){var t;
t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.browser.msie&&this.browser.version<11&&(this.phBr=""),this.editor=this.widget}return S(e,t),e.className="Util",e.prototype._init=function(){},e.prototype.phBr="<br/>",e.prototype.os=function(){var t;return t={},/Mac/.test(navigator.appVersion)?t.mac=!0:/Linux/.test(navigator.appVersion)?t.linux=!0:/Win/.test(navigator.appVersion)?t.win=!0:/X11/.test(navigator.appVersion)&&(t.unix=!0),/Mobi/.test(navigator.appVersion)&&(t.mobile=!0),t}(),e.prototype.browser=function(){var t,e,r,i,n;return n=navigator.userAgent,r=/(msie|trident)/i.test(n),t=/chrome|crios/i.test(n),i=/safari/i.test(n)&&!t,e=/firefox/i.test(n),r?{msie:!0,version:1*n.match(/(msie |rv:)(\d+(\.\d+)?)/i)[2]}:t?{webkit:!0,chrome:!0,version:1*n.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i)[1]}:i?{webkit:!0,safari:!0,version:1*n.match(/version\/(\d+(\.\d+)?)/i)[1]}:e?{mozilla:!0,firefox:!0,version:1*n.match(/firefox\/(\d+(\.\d+)?)/i)[1]}:{}}(),e.prototype.metaKey=function(t){var e;return e=/Mac/.test(navigator.userAgent),e?t.metaKey:t.ctrlKey},e.prototype.isEmptyNode=function(t){var e;return e=$(t),e.is(":empty")||!e.text()&&!e.find(":not(br, span, div)").length},e.prototype.isBlockNode=function(t){return t=$(t)[0],t&&3!==t.nodeType?/^(div|p|ul|ol|li|blockquote|hr|pre|h1|h2|h3|h4|table)$/.test(t.nodeName.toLowerCase()):!1},e.prototype.closestBlockEl=function(t){var e,r,i;return null==t&&(i=this.editor.selection.getRange(),t=null!=i?i.commonAncestorContainer:void 0),e=$(t),e.length?(r=e.parentsUntil(this.editor.body).addBack(),r=r.filter(function(t){return function(e){return t.isBlockNode(r.eq(e))}}(this)),r.length?r.last():null):null},e.prototype.furthestNode=function(t,e){var r,i,n;return null==t&&(n=this.editor.selection.getRange(),t=null!=n?n.commonAncestorContainer:void 0),r=$(t),r.length?(i=r.parentsUntil(this.editor.body).addBack(),i=i.filter(function(){return function(t){var r;return r=i.eq(t),$.isFunction(e)?e(r):r.is(e)}}(this)),i.length?i.first():null):null},e.prototype.furthestBlockEl=function(t){return this.furthestNode(t,this.isBlockNode)},e.prototype.getNodeLength=function(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}},e.prototype.traverseUp=function(t,e){var r,i,n,o,s,a,l;if(null==e&&(n=this.editor.selection.getRange(),e=null!=n?n.commonAncestorContainer:void 0),null==e||!$.contains(this.editor.body[0],e))return!1;for(i=$(e).parentsUntil(this.editor.body).get(),i.unshift(e),l=[],s=0,a=i.length;a>s&&(r=i[s],o=t(r),o!==!1);s++)l.push(void 0);return l},e.prototype.getShortcutKey=function(t){var e;return e=[],t.shiftKey&&e.push("shift"),t.ctrlKey&&e.push("ctrl"),t.altKey&&e.push("alt"),t.metaKey&&e.push("cmd"),e.push(t.which),e.join("+")},e.prototype.indent=function(){var t,e,r,i,n,o,s,a,l,d;if(t=this.editor.util.closestBlockEl(),!(t&&t.length>0))return!1;if(t.is("pre"))a=document.createTextNode("  "),this.editor.selection.insertNode(a);else if(t.is("li")){if(i=t.prev("li"),i.length<1)return!1;this.editor.selection.save(),l=t.parent()[0].tagName,e=i.children("ul, ol"),e.length>0?e.append(t):$("<"+l+"/>").append(t).appendTo(i),this.editor.selection.restore()}else if(t.is("p, h1, h2, h3, h4"))o=null!=(d=t.attr("data-indent"))?d:0,o=1*o+1,o>10&&(o=10),t.attr("data-indent",o);else if(t.is("table")){if(s=this.editor.selection.getRange(),n=$(s.commonAncestorContainer).closest("td"),r=n.next("td"),r.length>0||(r=n.parent("tr").next("tr").find("td:first")),!(n.length>0&&r.length>0))return!1;this.editor.selection.setRangeAtEndOf(r)}else a=document.createTextNode("    "),this.editor.selection.insertNode(a);return this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged"),!0},e.prototype.outdent=function(){var t,e,r,i,n,o,s,a,l;if(t=this.editor.util.closestBlockEl(),!(t&&t.length>0))return!1;if(t.is("pre"))return!1;if(t.is("li")){if(e=t.parent(),r=e.parent("li"),r.length<1)return o=this.editor.toolbar.findButton(e[0].tagName.toLowerCase()),null!=o&&o.command(),!1;this.editor.selection.save(),t.next("li").length>0&&$("<"+e[0].tagName+"/>").append(t.nextAll("li")).appendTo(t),t.insertAfter(r),e.children("li").length<1&&e.remove(),this.editor.selection.restore()}else if(t.is("p, h1, h2, h3, h4"))s=null!=(l=t.attr("data-indent"))?l:0,s=1*s-1,0>s&&(s=0),t.attr("data-indent",s);else{if(!t.is("table"))return!1;if(a=this.editor.selection.getRange(),n=$(a.commonAncestorContainer).closest("td"),i=n.prev("td"),i.length>0||(i=n.parent("tr").prev("tr").find("td:last")),!(n.length>0&&i.length>0))return!1;this.editor.selection.setRangeAtEndOf(i)}return this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged"),!0},e.prototype.dataURLtoBlob=function(t){var e,r,i,n,o,s,a,l,d,u,p;if(s=window.Blob&&function(){var t;try{return Boolean(new Blob)}catch(e){return t=e,!1}}(),o=s&&window.Uint8Array&&function(){var t;try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return t=e,!1}}(),e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,!((s||e)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(n=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),r=new ArrayBuffer(n.length),l=new Uint8Array(r),a=u=0,p=n.length;p>=0?p>=u:u>=p;a=p>=0?++u:--u)l[a]=n.charCodeAt(a);return d=t.split(",")[0].split(":")[1].split(";")[0],s?new Blob([o?l:r],{type:d}):(i=new e,i.append(r),i.getBlob(d))},e}(Plugin),k=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),this.editor=this.widget}return S(e,t),e.className="Toolbar",e.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1},e.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},e.prototype._init=function(){var t;if(this.opts.toolbar)return $.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(){return function(){return!1}}(this)),this.wrapper.on("mousedown",function(t){return function(){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),$(document).on("mousedown.simditor",function(t){return function(){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.width(this.wrapper.outerWidth()),this.editor.util.os.mobile||this.wrapper.css("left",this.wrapper.offset().left),t=this.wrapper.outerHeight(),$(window).on("scroll.simditor-"+this.editor.id,function(e){return function(){var r,i,n;if(n=e.editor.wrapper.offset().top,r=n+e.editor.wrapper.outerHeight()-80,i=$(document).scrollTop(),n>=i||i>=r){if(e.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),e.editor.util.os.mobile)return e.wrapper.css({top:"auto"})}else if(e.editor.wrapper.addClass("toolbar-floating").css("padding-top",t),e.editor.util.os.mobile)return e.wrapper.css({top:i-n})}}(this))),this.editor.on("selectionchanged focus",function(t){return function(){return t.toolbarStatus()}}(this)),this.editor.on("destroy",function(t){return function(){return t.buttons.length=0}}(this)),$(document).on("mousedown.simditor-"+this.editor.id,function(t){return function(){return t.list.find("li.menu-on").removeClass("menu-on")}}(this))},e.prototype._render=function(){var t,e,r,i;for(this.buttons=[],this.wrapper=$(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),i=this.opts.toolbar,e=0,r=i.length;r>e;e++)if(t=i[e],"|"!==t){if(!this.constructor.buttons[t])throw new Error('simditor: invalid toolbar button "'+t+'"');this.buttons.push(new this.constructor.buttons[t](this.editor))}else $(this._tpl.separator).appendTo(this.list);return this.opts.toolbarHidden?this.wrapper.hide():this.editor.placeholderEl.css("top",this.wrapper.outerHeight())},e.prototype.toolbarStatus=function(t){var e;if(this.editor.inputManager.focused)return e=this.buttons.slice(0),this.editor.util.traverseUp(function(){return function(r){var i,n,o,s,a,l,d;for(o=[],n=s=0,l=e.length;l>s;n=++s)i=e[n],(null==t||i.name===t)&&(i.status&&i.status($(r))!==!0||o.push(i));for(a=0,d=o.length;d>a;a++)i=o[a],n=$.inArray(i,e),e.splice(n,1);return 0===e.length?!1:void 0}}(this))},e.prototype.findButton=function(t){var e;return e=this.list.find(".toolbar-item-"+t).data("button"),null!=e?e:null},e.addButton=function(t){return this.buttons[t.prototype.name]=t},e.buttons={},e}(Plugin),w=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.connect(R),e.connect(E),e.connect(p),e.connect(h),e.connect(s),e.connect(_),e.connect(k),e.count=0,e.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,tabIndent:!0},e.prototype._init=function(){var t,r,i;if(this.textarea=$(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");return t=this.textarea.data("simditor"),null!=t&&t.destroy(),this.id=++e.count,this._render(),this.opts.upload&&("undefined"!=typeof simple&&null!==simple?simple.uploader:void 0)&&(i="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=simple.uploader(i)),r=this.textarea.closest("form"),r.length&&(r.on("submit.simditor-"+this.id,function(t){return function(){return t.sync()}}(this)),r.on("reset.simditor-"+this.id,function(t){return function(){return t.setValue("")}}(this))),this.on("pluginconnected",function(t){return function(){return t.opts.placeholder&&t.on("valuechanged",function(){return t._placeholder()}),t.setValue(t.textarea.val()||"")}}(this)),this.util.browser.mozilla?(document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)):void 0},e.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',e.prototype._render=function(){var t,e,r,i;if(this.el=$(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.append(this.textarea).data("simditor",this),this.textarea.data("simditor",this).hide().blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){r=this.opts.params,i=[];for(t in r)e=r[t],i.push($("<input/>",{type:"hidden",name:t,value:e}).insertAfter(this.textarea));return i}},e.prototype._placeholder=function(){var t,e;return t=this.body.children(),0===t.length||1===t.length&&this.util.isEmptyNode(t)&&(null!=(e=t.data("indent"))?e:0)<1?this.placeholderEl.show():this.placeholderEl.hide()},e.prototype.setValue=function(t){return this.hidePopover(),this.textarea.val(t),this.body.html(t),this.formatter.format(),this.formatter.decorate(),setTimeout(function(t){return function(){return t.trigger("valuechanged")}}(this),0)},e.prototype.getValue=function(){return this.sync()},e.prototype.sync=function(){var t,e,r,i,n,o;for(this.hidePopover,e=this.body.clone(),this.formatter.undecorate(e),this.formatter.format(e),this.formatter.autolink(e),t=e.children(),n=t.last("p"),i=t.first("p");n.is("p")&&this.util.isEmptyNode(n);)r=n,n=n.prev("p"),r.remove();for(;i.is("p")&&this.util.isEmptyNode(i);)r=i,i=n.next("p"),r.remove();return e.find("img.uploading").remove(),o=$.trim(e.html()),this.textarea.val(o),o},e.prototype.focus=function(){var t,e;if(this.inputManager.lastCaretPosition)return this.undoManager.caretPosition(this.inputManager.lastCaretPosition);if(t=this.body.find("p, li, pre, h1, h2, h3, h4, td").first(),t.length>0)return e=document.createRange(),this.selection.setRangeAtStartOf(t,e),this.body.focus()},e.prototype.blur=function(){return this.body.blur()},e.prototype.hidePopover=function(){return this.wrapper.find(".simditor-popover").each(function(){return function(t,e){return e=$(e).data("popover"),e.active?e.hide():void 0}}(this))},e.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),$(document).off(".simditor-"+this.id),$(window).off(".simditor-"+this.id),this.off()},e}(Widget),window.Simditor=w,r=function(t){function e(t){var e,r,i,n;for(this.editor=t,this.render(),this.el.on("mousedown",function(t){return function(e){var r,i;return e.preventDefault(),t.el.hasClass("disabled")||t.needFocus&&!t.editor.inputManager.focused?!1:t.menu?(t.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),t.wrapper.is(".menu-on")&&(r=t.menuWrapper.offset().left+t.menuWrapper.outerWidth()+5-t.editor.wrapper.offset().left-t.editor.wrapper.outerWidth(),r>0&&t.menuWrapper.css({left:"auto",right:0}),t.trigger("menuexpand")),!1):(i=t.el.data("param"),t.command(i),!1)}}(this)),this.wrapper.on("click","a.menu-item",function(t){return function(e){var r,i;return e.preventDefault(),r=$(e.currentTarget),t.wrapper.removeClass("menu-on"),r.hasClass("disabled")||t.needFocus&&!t.editor.inputManager.focused?!1:(t.editor.toolbar.wrapper.removeClass("menu-on"),i=r.data("param"),t.command(i),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(){return function(){return!1}}(this)),this.editor.on("blur",function(t){return function(){return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.inputManager.addShortcut(this.shortcut,function(t){return function(){return t.el.mousedown(),!1}}(this)),n=this.htmlTag.split(","),r=0,i=n.length;i>r;r++)e=n[r],e=$.trim(e),e&&$.inArray(e,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(e)}return S(e,t),e.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},e.prototype.name="",e.prototype.icon="",e.prototype.title="",e.prototype.text="",e.prototype.htmlTag="",e.prototype.disableTag="",e.prototype.menu=!1,e.prototype.active=!1,e.prototype.disabled=!1,e.prototype.needFocus=!0,e.prototype.shortcut=null,e.prototype.render=function(){return this.wrapper=$(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.el.find("span").addClass(this.icon?"fa fa-"+this.icon:"").text(this.text),this.menu?(this.menuWrapper=$(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()):void 0},e.prototype.renderMenu=function(){var t,e,r,i,n,o,s,a;if($.isArray(this.menu)){for(this.menuEl=$("<ul/>").appendTo(this.menuWrapper),o=this.menu,a=[],i=0,n=o.length;n>i;i++)r=o[i],"|"!==r?(e=$(this._tpl.menuItem).appendTo(this.menuEl),a.push(t=e.find("a.menu-item").attr({title:null!=(s=r.title)?s:r.text,"data-param":r.param}).addClass("menu-item-"+r.name).find("span").text(r.text))):$(this._tpl.separator).appendTo(this.menuEl);return a}},e.prototype.setActive=function(t){return t!==this.active?(this.active=t,this.el.toggleClass("active",this.active),this.editor.toolbar.trigger("buttonstatus",[this])):void 0},e.prototype.setDisabled=function(t){return t!==this.disabled?(this.disabled=t,this.el.toggleClass("disabled",this.disabled),this.editor.toolbar.trigger("buttonstatus",[this])):void 0},e.prototype.status=function(t){return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(null!=t&&this.setActive(t.is(this.htmlTag)),this.active)},e.prototype.command=function(){},e}(Module),window.SimditorButton=r,b=function(t){function e(t){this.editor=t,this.el=$('<div class="simditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",function(t){return function(){return t.el.addClass("hover")}}(this)),this.el.on("mouseleave",function(t){return function(){return t.el.removeClass("hover")}}(this))}return S(e,t),e.prototype.offset={top:4,left:0},e.prototype.target=null,e.prototype.active=!1,e.prototype.render=function(){},e.prototype.show=function(t,e){return null==e&&(e="bottom"),null!=t?(this.editor.hidePopover(),this.target=t.addClass("selected"),this.active?(this.refresh(e),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),setTimeout(function(t){return function(){return t.refresh(e),t.trigger("popovershow")}}(this),0))):void 0},e.prototype.hide=function(){return this.active?(this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")):void 0},e.prototype.refresh=function(t){var e,r,i,n,o;return null==t&&(t="bottom"),this.active?(e=this.editor.el.offset(),n=this.target.offset(),i=this.target.outerHeight(),"bottom"===t?o=n.top-e.top+i:"top"===t&&(o=n.top-e.top-this.el.height()),r=Math.min(n.left-e.left,this.editor.wrapper.width()-this.el.outerWidth()-10),this.el.css({top:o+this.offset.top,left:r+this.offset.left})):void 0},e.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},e}(Module),window.SimditorPopover=b,C=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="title",e.prototype.title="标题文字",e.prototype.htmlTag="h1, h2, h3, h4",e.prototype.disableTag="pre, table",e.prototype.menu=[{name:"normal",text:"普通文本",param:"p"},"|",{name:"h1",text:"标题 1",param:"h1"},{name:"h2",text:"标题 2",param:"h2"},{name:"h3",text:"标题 3",param:"h3"}],e.prototype.setActive=function(t,r){return e.__super__.setActive.call(this,t),this.el.removeClass("active-p active-h1 active-h2 active-h3"),t?this.el.addClass("active active-"+r):void 0},e.prototype.status=function(t){var e,r;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(null!=t&&(e=null!=(r=t[0].tagName)?r.toLowerCase():void 0,this.setActive(t.is(this.htmlTag),e)),this.active)},e.prototype.command=function(t){var e,r,i,n,o,s,a,l,d,u,p;for(s=this.editor.selection.getRange(),l=s.startContainer,n=s.endContainer,i=this.editor.util.closestBlockEl(l),r=this.editor.util.closestBlockEl(n),this.editor.selection.save(),s.setStartBefore(i[0]),s.setEndAfter(r[0]),e=$(s.extractContents()),a=[],e.children().each(function(e){return function(r,i){var n,o,s,l,d;for(o=e._convertEl(i,t),d=[],s=0,l=o.length;l>s;s++)n=o[s],d.push(a.push(n));return d}}(this)),p=a.reverse(),d=0,u=p.length;u>d;d++)o=p[d],s.insertNode(o[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e.prototype._convertEl=function(t,e){var r,i,n;return i=$(t),n=[],i.is(e)?n.push(i):(r=$("<"+e+"/>").append(i.contents()),n.push(r)),n},e}(r),w.Toolbar.addButton(C),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="bold",e.prototype.icon="bold",e.prototype.title="加粗文字",e.prototype.htmlTag="b, strong",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+66",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+66"),e.__super__.render.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(e=document.queryCommandState("bold")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("bold"),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),w.Toolbar.addButton(e),c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="italic",e.prototype.icon="italic",e.prototype.title="斜体文字",e.prototype.htmlTag="i",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+73",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+73"),e.__super__.render.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?this.disabled:(e=document.queryCommandState("italic")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("italic"),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),w.Toolbar.addButton(c),A=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="underline",e.prototype.icon="underline",e.prototype.title="下划线文字",e.prototype.htmlTag="u",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+85",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+85"),e.__super__.render.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?this.disabled:(e=document.queryCommandState("underline")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("underline"),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),w.Toolbar.addButton(A),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="color",e.prototype.icon="font",e.prototype.title="文字颜色",e.prototype.disableTag="pre",e.prototype.menu=!0,e.prototype.render=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.render.apply(this,t)},e.prototype.renderMenu=function(){return $('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-8" data-color=""></a></li>\n  <li class="remove-color"><a href="javascript:;" class="link-remove-color">去掉颜色</a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(){return!1}),this.menuWrapper.on("click",".font-color",function(t){return function(e){var r,i,n;return t.wrapper.removeClass("menu-on"),r=$(e.currentTarget),n=window.getComputedStyle(r[0],null).getPropertyValue("background-color"),(i=t._convertRgbToHex(n))?(document.execCommand("foreColor",!1,i),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")):void 0}}(this)),this.menuWrapper.on("click",".link-remove-color",function(t){return function(){var e,r,i;return t.wrapper.removeClass("menu-on"),e=t.editor.body.find("p, li"),e.length>0&&(i=window.getComputedStyle(e[0],null).getPropertyValue("color"),r=t._convertRgbToHex(i))?(document.execCommand("foreColor",!1,r),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")):void 0}}(this))},e.prototype._convertRgbToHex=function(t){var e,r,i;return r=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,(e=r.exec(t))?(i=function(t,e,r){var i;return i=function(t){var e;return e=t.toString(16),1===e.length?"0"+e:e},"#"+i(t)+i(e)+i(r)})(1*e[1],1*e[2],1*e[3]):""},e}(r),w.Toolbar.addButton(o),m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.type="",e.prototype.disableTag="pre, table",e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:null==t?this.active:(e="ul"===this.type?"ol":"ul",t.is(e)?(this.setActive(!1),!0):(this.setActive(t.is(this.htmlTag)),this.active))},e.prototype.command=function(){var t,e,r,i,n,o,s,a,l,d,u,p,c,h,f,g,m;for(u=this.editor.selection.getRange(),h=u.startContainer,a=u.endContainer,o=this.editor.util.closestBlockEl(h),e=this.editor.util.closestBlockEl(a),this.editor.selection.save(),u.setStartBefore(o[0]),u.setEndAfter(e[0]),o.is("li")&&e.is("li")&&(i=this.editor.util.furthestNode(o,"ul, ol"),r=this.editor.util.furthestNode(e,"ul, ol"),i.is(r)?(l=function(t){var e;for(e=1;!t.parent().is(i);)e+=1,t=t.parent();return e},c=l(o),s=l(e),n=c>s?e.parent():o.parent(),u.setStartBefore(n[0]),u.setEndAfter(n[0])):(u.setStartBefore(i[0]),u.setEndAfter(r[0]))),t=$(u.extractContents()),p=[],t.children().each(function(t){return function(e,r){var i,n,o,s,a;for(n=t._convertEl(r),a=[],o=0,s=n.length;s>o;o++)i=n[o],a.push(p.length&&p[p.length-1].is(t.type)&&i.is(t.type)?p[p.length-1].append(i.children()):p.push(i));return a}}(this)),m=p.reverse(),f=0,g=m.length;g>f;f++)d=m[f],u.insertNode(d[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e.prototype._convertEl=function(t){var e,r,i,n,o,s,a,l,d;if(e=$(t),s=[],r="ul"===this.type?"ol":"ul",e.is(this.type))e.children("li").each(function(t){return function(e,r){var i,n,o;return n=$(r),i=n.children("ul, ol").remove(),o=$("<p/>").append($(r).html()||t.editor.util.phBr),s.push(o),i.length>0?s.push(i):void 0}}(this));else if(e.is(r))i=$("<"+this.type+"/>").append(e.html()),s.push(i);else if(e.is("blockquote")){for(d=e.children().get(),a=0,l=d.length;l>a;a++)n=d[a],o=this._convertEl(n);$.merge(s,o)}else e.is("table")||(i=$("<"+this.type+"><li></li></"+this.type+">"),i.find("li").append(e.html()||this.editor.util.phBr),s.push(i));return s},e}(r),v=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.type="ol",e.prototype.name="ol",e.prototype.title="有序列表",e.prototype.icon="list-ol",e.prototype.htmlTag="ol",e.prototype.shortcut="cmd+191",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+191"),e.__super__.render.call(this)},e}(m),B=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.type="ul",e.prototype.name="ul",e.prototype.title="无序列表",e.prototype.icon="list-ul",e.prototype.htmlTag="ul",e.prototype.shortcut="cmd+190",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+190"),e.__super__.render.call(this)},e}(m),w.Toolbar.addButton(v),w.Toolbar.addButton(B),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="blockquote",e.prototype.icon="quote-left",e.prototype.title="引用",e.prototype.htmlTag="blockquote",e.prototype.disableTag="pre, table",e.prototype.command=function(){var t,e,r,i,n,o,s,a,l,d,u;for(o=this.editor.selection.getRange(),a=o.startContainer,i=o.endContainer,r=this.editor.util.furthestBlockEl(a),e=this.editor.util.furthestBlockEl(i),this.editor.selection.save(),o.setStartBefore(r[0]),o.setEndAfter(e[0]),t=$(o.extractContents()),s=[],t.children().each(function(t){return function(e,r){var i,n,o,a,l;for(n=t._convertEl(r),l=[],o=0,a=n.length;a>o;o++)i=n[o],l.push(s.length&&s[s.length-1].is(t.htmlTag)&&i.is(t.htmlTag)?s[s.length-1].append(i.children()):s.push(i));return l}}(this)),u=s.reverse(),l=0,d=u.length;d>l;l++)n=u[l],o.insertNode(n[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e.prototype._convertEl=function(t){var e,r,i;return e=$(t),i=[],e.is(this.htmlTag)?e.children().each(function(){return function(t,e){return i.push($(e))}}(this)):(r=$("<"+this.htmlTag+"/>").append(e),i.push(r)),i},e}(r),w.Toolbar.addButton(t),i=function(t){function e(t){this.editor=t,e.__super__.constructor.call(this,this.editor),this.editor.on("decorate",function(t){return function(e,r){return r.find("pre").each(function(e,r){return t.decorate($(r))})}}(this)),this.editor.on("undecorate",function(t){return function(e,r){return r.find("pre").each(function(e,r){return t.undecorate($(r))})}}(this))}return S(e,t),e.prototype.name="code",e.prototype.icon="code",e.prototype.title="插入代码",e.prototype.htmlTag="pre",e.prototype.disableTag="li, table",e.prototype.render=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new n(this.editor)},e.prototype.status=function(t){var r;return r=e.__super__.status.call(this,t),this.active?this.popover.show(t):this.editor.util.isBlockNode(t)&&this.popover.hide(),r},e.prototype.decorate=function(t){var e;return e=t.attr("data-lang"),t.removeClass(),e&&-1!==e?t.addClass("lang-"+e):void 0},e.prototype.undecorate=function(t){var e;return e=t.attr("data-lang"),t.removeClass(),e&&-1!==e?t.addClass("lang-"+e):void 0},e.prototype.command=function(){var t,e,r,i,n,o,s,a,l,d,u;for(o=this.editor.selection.getRange(),a=o.startContainer,i=o.endContainer,r=this.editor.util.closestBlockEl(a),e=this.editor.util.closestBlockEl(i),o.setStartBefore(r[0]),o.setEndAfter(e[0]),t=$(o.extractContents()),s=[],t.children().each(function(t){return function(e,r){var i,n,o,a,l;for(n=t._convertEl(r),l=[],o=0,a=n.length;a>o;o++)i=n[o],l.push(s.length&&s[s.length-1].is(t.htmlTag)&&i.is(t.htmlTag)?s[s.length-1].append(i.contents()):s.push(i));return l}}(this)),u=s.reverse(),l=0,d=u.length;d>l;l++)n=u[l],o.insertNode(n[0]);return this.editor.selection.setRangeAtEndOf(s[0]),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e.prototype._convertEl=function(t){var e,r,i,n;return e=$(t),n=[],e.is(this.htmlTag)?(r=$("<p/>").append(e.html().replace("\n","<br/>")),n.push(r)):(i=!e.text()&&1===e.children().length&&e.children().is("br")?"\n":this.editor.formatter.clearHtml(e),r=$("<"+this.htmlTag+"/>").text(i),n.push(r)),n},e}(r),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">选择程序语言</option>\n      <option value="c++">C++</option>\n      <option value="css">CSS</option>\n      <option value="coffeeScript">CoffeeScript</option>\n      <option value="html">Html,XML</option>\n      <option value="json">JSON</option>\n      <option value="java">Java</option>\n      <option value="js">JavaScript</option>\n      <option value="markdown">Markdown</option>\n      <option value="oc">Objective C</option>\n      <option value="php">PHP</option>\n      <option value="perl">Perl</option>\n      <option value="python">Python</option>\n      <option value="ruby">Ruby</option>\n      <option value="sql">SQL</option>\n    </select>\n  </div>\n</div>',e.prototype.render=function(){return this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),this.selectEl.on("change",function(t){return function(){var e;return t.lang=t.selectEl.val(),e=t.target.hasClass("selected"),t.target.removeClass().removeAttr("data-lang"),-1!==t.lang&&(t.target.addClass("lang-"+t.lang),t.target.attr("data-lang",t.lang)),e?t.target.addClass("selected"):void 0}}(this))},e.prototype.show=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.show.apply(this,t),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):void 0
},e}(b),w.Toolbar.addButton(i),f=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="link",e.prototype.icon="link",e.prototype.title="插入链接",e.prototype.htmlTag="a",e.prototype.disableTag="pre",e.prototype.render=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new g(this.editor)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:null==t?this.active:(e=!0,!t.is(this.htmlTag)||t.is('[class^="simditor-"]')?(this.setActive(!1),e=!1):this.editor.selection.rangeAtEndOf(t)?(this.setActive(!0),e=!1):this.setActive(!0),e?this.popover.show(t):this.editor.util.isBlockNode(t)&&this.popover.hide(),this.active)},e.prototype.command=function(){var t,e,r,i,n,o,s,a,l,d;return a=this.editor.selection.getRange(),this.active?(r=$(a.commonAncestorContainer).closest("a"),d=document.createTextNode(r.text()),r.replaceWith(d),a.selectNode(d)):(l=a.startContainer,o=a.endContainer,n=this.editor.util.closestBlockEl(l),e=this.editor.util.closestBlockEl(o),t=$(a.extractContents()),s=this.editor.formatter.clearHtml(t.contents(),!1),r=$("<a/>",{href:"http://www.example.com",target:"_blank",text:s||"链接文字"}),n[0]===e[0]?a.insertNode(r[0]):(i=$("<p/>").append(r),a.insertNode(i[0])),a.selectNodeContents(r[0]),this.popover.one("popovershow",function(t){return function(){return s?(t.popover.urlEl.focus(),t.popover.urlEl[0].select()):(t.popover.textEl.focus(),t.popover.textEl[0].select())}}(this))),this.editor.selection.selectRange(a),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),g=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype._tpl='<div class="link-settings">\n  <div class="settings-field">\n    <label>文本</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="取消链接" tabindex="-1"><span class="fa fa-unlink"></span></a>\n  </div>\n  <div class="settings-field">\n    <label>链接</label>\n    <input class="link-url" type="text"/>\n  </div>\n</div>',e.prototype.render=function(){return this.el.addClass("link-popover").append(this._tpl),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.textEl.on("keyup",function(t){return function(e){return 13!==e.which?t.target.text(t.textEl.val()):void 0}}(this)),this.urlEl.on("keyup",function(t){return function(e){return 13!==e.which?t.target.attr("href",t.urlEl.val()):void 0}}(this)),$([this.urlEl[0],this.textEl[0]]).on("keydown",function(t){return function(e){return 13===e.which||27===e.which||!e.shiftKey&&9===e.which&&$(e.target).hasClass("link-url")?(e.preventDefault(),setTimeout(function(){var e;return e=document.createRange(),t.editor.selection.setRangeAfter(t.target,e),t.hide(),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")},0)):void 0}}(this)),this.unlinkEl.on("click",function(t){return function(){var e,r;return r=document.createTextNode(t.target.text()),t.target.replaceWith(r),t.hide(),e=document.createRange(),t.editor.selection.setRangeAfter(r,e),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged")}}(this))},e.prototype.show=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},e}(b),w.Toolbar.addButton(f),l=function(t){function e(t){this.editor=t,null==this.editor.uploader&&(this.menu=!1),e.__super__.constructor.call(this,this.editor),this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",function(t){return function(e){var r,i;return r=$(e.currentTarget),i=document.createRange(),i.selectNode(r[0]),t.editor.selection.selectRange(i),setTimeout(function(){return t.editor.body.focus(),t.editor.trigger("selectionchanged")},0),!1}}(this)),this.editor.body.on("mouseup","img:not([data-non-image])",function(){return function(){return!1}}(this)),this.editor.on("selectionchanged.image",function(t){return function(){var e,r,i;return i=t.editor.selection.sel.getRangeAt(0),null!=i?(e=$(i.cloneContents()).contents(),1===e.length&&e.is("img:not([data-non-image])")?(r=$(i.startContainer).contents().eq(i.startOffset),t.popover.show(r)):t.popover.hide()):void 0}}(this)),this.editor.on("valuechanged.image",function(t){return function(){var e;return e=t.editor.wrapper.find(".simditor-image-loading"),e.length>0?e.each(function(e,r){var i,n,o;return n=$(r),i=n.data("img"),!(i&&i.parent().length>0)&&(n.remove(),i&&(o=i.data("file"),o&&(t.editor.uploader.cancel(o),t.editor.body.find("img.uploading").length<1)))?t.editor.uploader.trigger("uploadready",[o]):void 0}):void 0}}(this))}return S(e,t),e.prototype.name="image",e.prototype.icon="picture-o",e.prototype.title="插入图片",e.prototype.htmlTag="img",e.prototype.disableTag="pre, table",e.prototype.defaultImage="",e.prototype.needFocus=!1,e.prototype.menu=[{name:"upload-image",text:"本地图片"},{name:"external-image",text:"外链图片"}],e.prototype.render=function(){var t;return t=1<=arguments.length?M.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new d(this)},e.prototype.renderMenu=function(){var t,r,i;return e.__super__.renderMenu.call(this),r=this.menuEl.find(".menu-item-upload-image"),t=null,i=function(){return function(){return t&&t.remove(),t=$('<input type="file" title="上传图片" accept="image/*">').appendTo(r)}}(this),i(),r.on("click mousedown","input[type=file]",function(){return function(t){return t.stopPropagation()}}(this)),r.on("change","input[type=file]",function(e){return function(){return e.editor.inputManager.focused?(e.editor.uploader.upload(t,{inline:!0}),i()):(e.editor.one("focus",function(){return e.editor.uploader.upload(t,{inline:!0}),i()}),e.editor.focus()),e.wrapper.removeClass("menu-on")}}(this)),this._initUploader()},e.prototype._initUploader=function(){return null==this.editor.uploader?void this.el.find(".btn-upload").remove():(this.editor.uploader.on("beforeupload",function(t){return function(e,r){var i;if(r.inline)return r.img?i=$(r.img):(i=t.createImage(r.name),r.img=i),i.addClass("uploading"),i.data("file",r),t.editor.uploader.readImageFile(r.obj,function(e){var r;if(i.hasClass("uploading"))return r=e?e.src:t.defaultImage,t.loadImage(i,r,function(){return t.popover.refresh(),t.popover.srcEl.val("正在上传...").prop("disabled",!0)})})}}(this)),this.editor.uploader.on("uploadprogress",function(){return function(t,e,r,i){var n,o,s;if(e.inline)return s=r/i,s=(100*s).toFixed(0),s>99&&(s=99),o=e.img.data("mask"),o?(n=o.data("img"),n&&n.parent().length>0?o.find("span").text(s):o.remove()):void 0}}(this)),this.editor.uploader.on("uploadsuccess",function(t){return function(e,r,i){var n,o,s;if(r.inline)return n=r.img,n.removeData("file"),n.removeClass("uploading"),o=n.data("mask"),o&&o.remove(),n.removeData("mask"),i.success===!1?(s=i.msg||"上传被拒绝了","undefined"!=typeof simple&&null!==simple&&null!=simple.message?simple.message({content:s}):alert(s),n.attr("src",t.defaultImage)):n.attr("src",i.file_path),t.popover.srcEl.prop("disabled",!1),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[r,i]):void 0}}(this)),this.editor.uploader.on("uploaderror",function(t){return function(e,r,i){var n,o,s,a;if(r.inline&&"abort"!==i.statusText){if(i.responseText){try{a=$.parseJSON(i.responseText),s=a.msg}catch(l){e=l,s="上传出错了"}"undefined"!=typeof simple&&null!==simple&&null!=simple.message?simple.message({content:s}):alert(s)}return n=r.img,n.removeData("file"),n.removeClass("uploading"),o=n.data("mask"),o&&o.remove(),n.removeData("mask"),n.attr("src",t.defaultImage),t.popover.srcEl.prop("disabled",!1),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[r,a]):void 0}}}(this)))},e.prototype.status=function(t){return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:void 0},e.prototype.loadImage=function(t,e,r){var i,n;return i=t.data("mask"),i||(i=$('<div class="simditor-image-loading"><span></span></div>').hide().appendTo(this.editor.wrapper),t.hasClass("uploading")&&i.addClass("uploading"),t.data("mask",i),i.data("img",t)),n=new Image,n.onload=function(o){return function(){var s,a,l,d;return l=n.width,s=n.height,t.attr({src:e,"data-image-size":l+","+s}),t.hasClass("uploading")?(o.editor.body[0].offsetHeight,d=o.editor.wrapper.offset(),a=t.offset(),i.css({top:a.top-d.top,left:a.left-d.left,width:t.width(),height:t.height()}).show()):(i.remove(),t.removeData("mask")),r(n)}}(this),n.onerror=function(){return function(){return r(!1),i.remove(),t.removeData("mask")}}(this),n.src=e},e.prototype.createImage=function(t){var e,r,i,n;return null==t&&(t="Image"),this.editor.inputManager.focused||this.editor.focus(),n=this.editor.selection.getRange(),n.deleteContents(),e=this.editor.util.closestBlockEl(),e.is("p")&&!this.editor.util.isEmptyNode(e)&&(e=$("<p/>").append(this.editor.util.phBr).insertAfter(e),this.editor.selection.setRangeAtStartOf(e,n)),r=$("<img/>").attr("alt",t),n.insertNode(r[0]),i=e.next("p"),i.length>0||(i=$("<p/>").append(this.editor.util.phBr).insertAfter(e)),this.editor.selection.setRangeAtStartOf(i),r},e.prototype.command=function(t){var e;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,function(t){return function(){return t.editor.trigger("valuechanged"),e[0].offsetHeight,e.click(),t.popover.one("popovershow",function(){return t.popover.srcEl.focus(),t.popover.srcEl[0].select()})}}(this))},e}(r),d=function(t){function e(t){this.button=t,e.__super__.constructor.call(this,this.button.editor)}return S(e,t),e.prototype._tpl='<div class="link-settings">\n  <div class="settings-field">\n    <label>图片地址</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;" title="上传图片" tabindex="-1">\n      <span class="fa fa-upload"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>图片尺寸</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;" title="还原尺寸" tabindex="-1">\n      <span class="fa fa-reply"></span>\n    </a>\n  </div>\n</div>',e.prototype.offset={top:6,left:-4},e.prototype.render=function(){return this.el.addClass("image-popover").append(this._tpl),this.srcEl=this.el.find(".image-src"),this.srcEl.on("keydown",function(t){return function(e){var r;return 13===e.which||27===e.which?(e.preventDefault(),13!==e.which||t.target.hasClass("uploading")?(t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide()):(r=t.srcEl.val(),t.button.loadImage(t.target,r,function(e){return e?(t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide(),t.editor.trigger("valuechanged")):void 0}))):void 0}}(this)),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.el.find(".image-size").on("blur",function(t){return function(e){return t._resizeImg($(e.currentTarget)),t.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(t){return function(e){var r;return r=$(e.currentTarget),13!==e.which&&27!==e.which&&9!==e.which?t._resizeImg(r,!0):void 0}}(this)),this.el.find(".image-size").on("keydown",function(t){return function(e){var r;return r=$(e.currentTarget),13===e.which||27===e.which?(e.preventDefault(),13===e.which?t._resizeImg(r):t._restoreImg(),t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide()):9===e.which?t.el.data("popover").refresh():void 0}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(){return t.active?t.refresh():void 0}}(this)),this._initUploader()},e.prototype._initUploader=function(){var t,e;return t=this.el.find(".btn-upload"),null==this.editor.uploader?void t.remove():(e=function(e){return function(){return e.input&&e.input.remove(),e.input=$('<input type="file" title="上传图片" accept="image/*">').appendTo(t)}}(this),e(),this.el.on("click mousedown","input[type=file]",function(){return function(t){return t.stopPropagation()}}(this)),this.el.on("change","input[type=file]",function(t){return function(){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),e()}}(this)))},e.prototype._resizeImg=function(t,e){var r,i,n;return null==e&&(e=!1),i=1*t.val(),$.isNumeric(i)||0>i?(t.is(this.widthEl)?(r=this.height*i/this.width,this.heightEl.val(r)):(n=this.width*i/this.height,this.widthEl.val(n)),e?void 0:this.target.attr({width:n||i,height:r||i})):void 0},e.prototype._restoreImg=function(){var t,e;return t=(null!=(e=this.target.data("image-size"))?e.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*t[0],height:1*t[1]}),this.widthEl.val(t[0]),this.heightEl.val(t[1])},e.prototype.show=function(){var t,r;return r=1<=arguments.length?M.call(arguments,0):[],e.__super__.show.apply(this,r),t=this.target,this.width=t.width(),this.height=t.height(),t.hasClass("uploading")?this.srcEl.val("正在上传"):(this.srcEl.val(t.attr("src")),this.widthEl.val(this.width),this.heightEl.val(this.height))},e}(b),w.Toolbar.addButton(l),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="indent",e.prototype.icon="indent",e.prototype.title="向右缩进（Tab）",e.prototype.status=function(){return!0},e.prototype.command=function(){return this.editor.util.indent()},e}(r),w.Toolbar.addButton(u),y=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="outdent",e.prototype.icon="outdent",e.prototype.title="向左缩进（Shift + Tab）",e.prototype.status=function(){return!0},e.prototype.command=function(){return this.editor.util.outdent()},e}(r),w.Toolbar.addButton(y),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="hr",e.prototype.icon="minus",e.prototype.title="分隔线",e.prototype.htmlTag="hr",e.prototype.status=function(){return!0},e.prototype.command=function(){var t,e,r,i;return i=this.editor.util.furthestBlockEl(),r=i.next(),r.length>0?this.editor.selection.save():e=$("<p/>").append(this.editor.util.phBr),t=$("<hr/>").insertAfter(i),e?(e.insertAfter(t),this.editor.selection.setRangeAtStartOf(e)):this.editor.selection.restore(),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),w.Toolbar.addButton(a),T=function(t){function e(){var t;t=1<=arguments.length?M.call(arguments,0):[],e.__super__.constructor.apply(this,t),$.merge(this.editor.formatter._allowedTags,["tbody","tr","td","colgroup","col"]),$.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),this.editor.on("decorate",function(t){return function(e,r){return r.find("table").each(function(e,r){return t.decorate($(r))})}}(this)),this.editor.on("undecorate",function(t){return function(e,r){return r.find("table").each(function(e,r){return t.undecorate($(r))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(){var e,r;return t.editor.body.find(".simditor-table td").removeClass("active"),r=t.editor.selection.getRange(),null!=r?(e=$(r.commonAncestorContainer),r.collapsed&&e.is(".simditor-table")&&(e=e.find(t.editor.selection.rangeAtStartOf(e)?"td:first":"td:last"),t.editor.selection.setRangeAtEndOf(e)),e.closest("td",t.editor.body).addClass("active")):void 0}}(this)),this.editor.on("blur.table",function(t){return function(){return t.editor.body.find(".simditor-table td").removeClass("active")}}(this)),this.editor.inputManager.addKeystrokeHandler("38","td",function(t){return function(e,r){var i,n,o;return n=r.parent("tr"),i=n.prev("tr"),i.length>0?(o=n.find("td").index(r),t.editor.selection.setRangeAtEndOf(i.find("td").eq(o)),!0):!0}}(this)),this.editor.inputManager.addKeystrokeHandler("40","td",function(t){return function(e,r){var i,n,o;return n=r.parent("tr"),i=n.next("tr"),i.length>0?(o=n.find("td").index(r),t.editor.selection.setRangeAtEndOf(i.find("td").eq(o)),!0):!0}}(this))}return S(e,t),e.prototype.name="table",e.prototype.icon="table",e.prototype.title="表格",e.prototype.htmlTag="table",e.prototype.disableTag="pre, li, blockquote",e.prototype.menu=!0,e.prototype.initResize=function(t){var e,r,i;return i=t.parent(".simditor-table"),e=t.find("colgroup"),e.length<1&&(e=$("<colgroup/>").prependTo(t),t.find("tr:first td").each(function(){return function(){var t;return t=$("<col/>").appendTo(e)}}(this)),this.refreshTableWidth(t)),r=$('<div class="simditor-resize-handle" contenteditable="false"></div>').appendTo(i),i.on("mousemove","td",function(){return function(t){var n,o,s,a,l,d;if(!i.hasClass("resizing"))return o=$(t.currentTarget),a=t.pageX-$(t.currentTarget).offset().left,5>a&&o.prev().length>0&&(o=o.prev()),o.next("td").length<1?void r.hide():(null!=(l=r.data("td"))?l.is(o):void 0)?void r.show():(s=o.parent().find("td").index(o),n=e.find("col").eq(s),(null!=(d=r.data("col"))?d.is(n):void 0)?void r.show():r.css("left",o.position().left+o.outerWidth()-5).data("td",o).data("col",n).show())}}(this)),i.on("mouseleave",function(){return function(){return r.hide()}}(this)),i.on("mousedown",".simditor-resize-handle",function(){return function(t){var e,r,n,o,s,a,l,d,u,p,c;return e=$(t.currentTarget),n=e.data("td"),r=e.data("col"),s=n.next("td"),o=r.next("col"),p=t.pageX,d=1*n.outerWidth(),u=1*s.outerWidth(),l=parseFloat(e.css("left")),c=n.closest("table").width(),a=50,$(document).on("mousemove.simditor-resize-table",function(t){var i,n,s;return i=t.pageX-p,n=d+i,s=u-i,a>n?(n=a,i=a-d,s=u-i):a>s&&(s=a,i=u-a,n=d+i),r.attr("width",n/c*100+"%"),o.attr("width",s/c*100+"%"),e.css("left",l+i)}),$(document).one("mouseup.simditor-resize-table",function(){return $(document).off(".simditor-resize-table"),i.removeClass("resizing")}),i.addClass("resizing"),!1}}(this))},e.prototype.decorate=function(t){return t.parent(".simditor-table").length>0&&this.undecorate(t),t.wrap('<div class="simditor-table"></div>'),this.initResize(t),t.parent()},e.prototype.undecorate=function(t){return t.parent(".simditor-table").length>0?t.parent().replaceWith(t):void 0},e.prototype.renderMenu=function(){return $('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteRow"><span>删除行</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowAbove"><span>在上面插入行</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowBelow"><span>在下面插入行</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteCol"><span>删除列</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColLeft"><span>在左边插入列</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColRight"><span>在右边插入列</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteTable"><span>删除表格</span></a></li>\n  </ul>\n</div>').appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td",function(t){return function(e){var r,i,n;return t.createMenu.find("td").removeClass("selected"),r=$(e.currentTarget),i=r.parent(),n=i.find("td").index(r)+1,i.prevAll("tr").addBack().find("td:lt("+n+")").addClass("selected")}}(this)),this.createMenu.on("mouseleave",function(){return function(t){return $(t.currentTarget).find("td").removeClass("selected")}}(this)),this.createMenu.on("mousedown","td",function(t){return function(e){var r,i,n,o,s,a;return t.wrapper.removeClass("menu-on"),t.editor.inputManager.focused?(n=$(e.currentTarget),o=n.parent(),s=o.find("td").index(n)+1,a=o.prevAll("tr").length+1,i=t.createTable(a,s,!0),r=t.editor.util.closestBlockEl(),t.editor.util.isEmptyNode(r)?r.replaceWith(i):r.after(i),t.decorate(i),t.editor.selection.setRangeAtStartOf(i.find("td:first")),t.editor.trigger("valuechanged"),t.editor.trigger("selectionchanged"),!1):void 0}}(this))},e.prototype.createTable=function(t,e,r){var i,n,o,s,a,l,d,u;for(i=$("<table/>"),n=$("<tbody/>").appendTo(i),l=d=0;t>=0?t>d:d>t;l=t>=0?++d:--d)for(s=$("<tr/>").appendTo(n),a=u=0;e>=0?e>u:u>e;a=e>=0?++u:--u)o=$("<td/>").appendTo(s),r&&o.append(this.editor.util.phBr);return i},e.prototype.refreshTableWidth=function(t){var e,r;return r=t.width(),e=t.find("col"),t.find("tr:first td").each(function(){return function(t,i){var n;return n=e.eq(t),n.attr("width",$(i).outerWidth()/r*100+"%")}}(this))},e.prototype.setActive=function(t){return e.__super__.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},e.prototype.deleteRow=function(t){var e,r,i;return r=t.parent("tr"),r.siblings("tr").length<1?this.deleteTable(t):(e=r.next("tr"),e.length>0||(e=r.prev("tr")),i=r.find("td").index(t),r.remove(),this.editor.selection.setRangeAtEndOf(e.find("td").eq(i)))},e.prototype.insertRow=function(t,e){var r,i,n,o,s,a,l;for(null==e&&(e="after"),n=t.parent("tr"),i=n.closest("table"),o=0,i.find("tr").each(function(){return function(t,e){return o=Math.max(o,$(e).find("td").length)}}(this)),r=$("<tr/>"),s=l=1;o>=1?o>=l:l>=o;s=o>=1?++l:--l)$("<td/>").append(this.editor.util.phBr).appendTo(r);return n[e](r),a=n.find("td").index(t),this.editor.selection.setRangeAtStartOf(r.find("td").eq(a))},e.prototype.deleteCol=function(t){var e,r,i,n;return i=t.parent("tr"),i.siblings("tr").length<1&&t.siblings("td").length<1?this.deleteTable(t):(n=i.find("td").index(t),e=t.next("td"),e.length>0||(e=i.prev("td")),r=i.closest("table"),r.find("col").eq(n).remove(),r.find("tr").each(function(){return function(t,e){return $(e).find("td").eq(n).remove()}}(this)),this.refreshTableWidth(r),this.editor.selection.setRangeAtEndOf(e))},e.prototype.insertCol=function(t,e){var r,i,n,o,s,a,l,d;return null==e&&(e="after"),s=t.parent("tr"),a=s.find("td").index(t),o=t.closest("table"),r=o.find("col").eq(a),o.find("tr").each(function(t){return function(r,i){var n;return n=$("<td/>").append(t.editor.util.phBr),$(i).find("td").eq(a)[e](n)}}(this)),i=$("<col/>"),r[e](i),l=o.width(),d=Math.max(parseFloat(r.attr("width"))/2,50/l*100),r.attr("width",d+"%"),i.attr("width",d+"%"),this.refreshTableWidth(o),n="after"===e?t.next("td"):t.prev("td"),this.editor.selection.setRangeAtStartOf(n)},e.prototype.deleteTable=function(t){var e,r;return r=t.closest(".simditor-table"),e=r.next("p"),r.remove(),e.length>0?this.editor.selection.setRangeAtStartOf(e):void 0},e.prototype.command=function(t){var e,r;if(r=this.editor.selection.getRange(),e=$(r.commonAncestorContainer).closest("td"),e.length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")}},e}(r),w.Toolbar.addButton(T),x=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,t),e.prototype.name="strikethrough",e.prototype.icon="strikethrough",e.prototype.title="删除线文字",e.prototype.htmlTag="strike",e.prototype.disableTag="pre",e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(e=document.queryCommandState("strikethrough")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.trigger("valuechanged"),this.editor.trigger("selectionchanged")},e}(r),w.Toolbar.addButton(x)}.call(this);