var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};!function(a){return"function"==typeof define&&define.amd?define(["simditor","marked"],a):a(window.Simditor,window.marked)}(function(a,b){var c;return c=function(a){function c(){if(c.__super__.constructor.apply(this,arguments),this.marked=b,!b)throw new Error("cannot find the plugin marked")}return __extends(c,a),c.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + m )":(this.title=this.title+" ( Ctrl + m )",this.shortcut="ctrl+m"),c.__super__._init.call(this)},c.prototype.name="marked",c.prototype.title="marked",c.prototype.icon="maxcdn",c.prototype.shortcut="cmd+m",c.prototype.decodeHTML=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.innerText||b.textContent},c.prototype.encodeHTML=function(a){var b;return b=document.createElement("div"),b.appendChild(document.createTextNode(a)),b.innerHTML},c.prototype.decodeCodes=function(a){var b,c,d,e,f,g;for(d=document.createElement("div"),d.innerHTML=a,c=d.querySelectorAll("code"),f=0,g=c.length;g>f;f++)b=c[f],e=this.decodeHTML(b.innerText||d.textContent),b.innerText&&(b.innerText=e),b.textContent&&(b.textContent=e);return d.innerHTML},c.prototype.replaceSelection=function(a,b){var c,d,e,f,g,h,i;if(null==b&&(b=!0),i=window.getSelection(),i.getRangeAt&&i.rangeCount){if(h=window.getSelection().getRangeAt(0),h.deleteContents(),h.createContextualFragment)f=h.createContextualFragment(a);else for(d=document.createElement("div"),d.innerHTML=a,f=document.createDocumentFragment();c=d.firstChild;)f.appendChild(c);if(e=f.firstChild,g=f.lastChild,h.insertNode(f),b)return e&&(h.setStartBefore(e),h.setEndAfter(g)),i.removeAllRanges(),i.addRange(h)}},c.prototype.doReplaceSelction=function(a){var b;return b=this.marked(this.encodeHTML(a)),b=this.decodeCodes(b),this.replaceSelection(b)},c.prototype.doReplaceAll=function(){var a;return a=this.editor.getValue(),a=a.replace(/<p>/g,"").replace(/<\/p>/g,"\n"),a=this.marked(a),a=this.decodeCodes(a),this.editor.setValue(a)},c.prototype.command=function(){var a;return a=window.getSelection().toString(),0===a.length?this.doReplaceAll():this.doReplaceSelction(a),this.editor.selection.setRangeAtEndOf("p")},c}(a.Button),a.Toolbar.addButton(c)});